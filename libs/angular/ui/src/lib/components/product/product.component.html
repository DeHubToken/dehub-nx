<div [dhbContentfulDraft]="product.sys">
  <p-card
    *ngIf="product"
    [header]="product.name ?? ''"
    styleClass="product p-card-shadow h-full"
  >
    <!-- Header -->
    <ng-template pTemplate="header">
      <swiper-container dhbSwiper [swiperOptions]="swiperOptions" init="false">
        <swiper-slide
          *ngFor="let picture of product.picturesCollection?.items ?? []"
        >
          <img
            *ngIf="picture"
            [dhbContentfulDraft]="picture.sys"
            [src]="picture.url"
            [alt]="picture.title"
          />
        </swiper-slide>
      </swiper-container>
    </ng-template>

    <!-- Body -->
    <div
      class="flex flex-wrap sm:flex-nowrap justify-content-end align-items-start"
    >
      <div class="flex-grow-1 pr-3 mb-4">
        <p>
          {{ product.shortDescription }}
        </p>
      </div>

      <!-- Price Widget -->
      <div
        class="card overview-box gray shadow-2 flex-none pt-1 pb-3 min-w-full sm:min-w-max"
      >
        <div class="overview-info text-right w-full">
          <!-- Price -->
          <h3 class="mt-1 mb-0 pr-0">{{ product.price | number }}</h3>

          <!-- Currency -->
          <h6 class="text-sm mb-2 opacity-80">
            {{ product.currency }}
          </h6>

          <!-- Quantity -->
          <h6 class="my-0 text-sm inline-block w-full">
            <hr class="my-0 pb-1 border-dashed" />

            <ng-container
              *ngIf="product.availableQuantity ?? 0 > 0; else unavailable"
            >
              <span class="text-bold opacity-80">{{
                product.availableQuantity
              }}</span>
              <span class="opacity-80 text-xs text-bold pr-1">
                left in stock</span
              >
            </ng-container>

            <ng-template #unavailable>
              <span *ngIf="product.pause; else soldOut" class="text-bold">
                Coming Soon
              </span>
              <ng-template #soldOut>
                <span class="text-bold">{{
                  product.soldOutLabel || 'Sold Out'
                }}</span>
              </ng-template>
            </ng-template>
          </h6>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <ng-template pTemplate="footer">
      <div class="flex justify-content-end">
        <!-- Details -->
        <p-button
          [routerLink]="['/shop', product.slug]"
          label="Details"
          class="w-6 md:w-auto"
          styleClass="p-button-secondary p-button-lg w-full"
        ></p-button>

        <!-- Buy -->
        <p-button
          *ngIf="product.availableQuantity ?? 0 > 0"
          [routerLink]="
            product.pause
              ? null
              : [{ outlets: { modal: ['checkout', product.slug] } }]
          "
          [label]="product.pause ? 'Coming Soon' : 'Buy'"
          [disabled]="product.pause ?? false"
          styleClass="p-button-primary p-button-lg ml-2"
          class="w-6 md:w-auto"
        ></p-button>
      </div>
    </ng-template>
  </p-card>
</div>
